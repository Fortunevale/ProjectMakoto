name: Test Build
on:
  push:
    branches: [ "dev" ]
  workflow_dispatch:
  pull_request:
jobs:
  push:
    name: Build Project
    runs-on: self-hosted
    steps:
      - name: Cleanup before build
        run: rm -rf ProjectMakotoTest/
      - name: Setup .NET Core SDK 7.x
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.x'
      - name: "Clone Repository"
        uses: actions/checkout@v3
        with:
          submodules: recursive
          path: ProjectMakotoTest
          token: ${{ secrets.Access_token }}
      - name: Install dependencies
        run: dotnet restore
        working-directory: ProjectMakotoTest/ProjectMakoto/
      - name: Remove TranslationSourceGenerator from Test Build
        run: dotnet sln remove ..\TranslationSourceGenerator\TranslationSourceGenerator.csproj
        working-directory: ProjectMakoto/ProjectMakoto/
      - name: Test Build Makoto
        run: dotnet publish --configuration RELEASE --runtime linux-x64 --no-self-contained
        working-directory: ProjectMakotoTest/ProjectMakoto/
